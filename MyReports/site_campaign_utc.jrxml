<?xml version="1.0" encoding="UTF-8"?>
<!-- Created with Jaspersoft Studio version last-->
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="site_campaign" pageWidth="842" pageHeight="595" orientation="Landscape" columnWidth="802" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="7f95c384-8e1b-4cfb-bf05-5d77eeb05348">
	<property name="ireport.jasperserver.url" value="http://jasper:8080/jasperserver/"/>
	<property name="ireport.jasperserver.report.resource" value="/Reports/Campaign_Activity_By_Site_UTC_files/main_jrxml"/>
	<property name="ireport.jasperserver.reportUnit" value="/Reports/Campaign_Activity_By_Site_UTC"/>
	<property name="com.jaspersoft.studio.data.defaultdataadapter" value="Deepthought"/>
	<parameter name="date_range" class="java.lang.String">
		<parameterDescription><![CDATA[]]></parameterDescription>
		<defaultValueExpression><![CDATA["DAY-0"]]></defaultValueExpression>
	</parameter>
	<parameter name="custom_date" class="java.util.Date">
		<parameterDescription><![CDATA[]]></parameterDescription>
	</parameter>
	<parameter name="report_date" class="net.sf.jasperreports.types.date.DateRange" isForPrompting="false">
		<parameterDescription><![CDATA[]]></parameterDescription>
		<defaultValueExpression><![CDATA[($P{date_range}.equals("custom") || $P{custom_date} != null) ? DATERANGE($P{custom_date}) : DATERANGE( $P{date_range})]]></defaultValueExpression>
	</parameter>
	<queryString language="SQL">
		<![CDATA[select cr.site_name,cr.campaign,cr.minireels,cr.loads,cc.cards,cc.cardviews,cc.plays,cc.adcounts
from (
	select site_name,campaign,sum(mr_count) as minireels, sum(loads) as loads
	from (
		select c.site_name,c.campaign,c.experience_id,c.mr_count,e.loads
		from (
			select sa.site_name,sa.campaign,sa.experience_id, 1 as mr_count
			from fct.v_sponsored_card_activity sa
			where $X{EQUAL, sa.rec_ts::date,report_date} and sa.site_name is not null
			group by sa.site_name,sa.campaign,sa.experience_id
		) c
		left join (
			select h.site_name,e.experience_id,sum(pageviews) as loads
			from fct.mr_embeds_by_device e
			inner join rpt.hostname_to_site h ON h.container = e.mr_container AND h.hostname = e.hostname
			where  $X{EQUAL, e.rec_ts::date,report_date}
			group by h.site_name,e.experience_id
		) e ON c.site_name = e.site_name AND c.experience_id = e.experience_id
	) i
	group by site_name,campaign
) as cr
left join (
	select site_name,campaign,sum(cardviews) as cardviews, sum(plays) as plays, sum(adcounts) as adcounts, sum(Crd_count) as cards
	from (
		select site_name,campaign,card_id,sum(cardviews) as cardviews, sum(play) as plays, sum(adcount) as adcounts, 1 as crd_count
		from fct.v_sponsored_card_activity
		where  $X{EQUAL, rec_ts::date,report_date} and site_name is not null
		group by site_name,campaign,card_id
	) as i
	group by site_name,campaign
) as cc ON cr.site_name = cc.site_name AND cr.campaign = cc.campaign
order by cr.site_name,cr.campaign]]>
	</queryString>
	<field name="site_name" class="java.lang.String"/>
	<field name="campaign" class="java.lang.String"/>
	<field name="minireels" class="java.lang.Long"/>
	<field name="loads" class="java.lang.Long"/>
	<field name="cards" class="java.lang.Long"/>
	<field name="cardviews" class="java.lang.Long"/>
	<field name="plays" class="java.lang.Long"/>
	<field name="adcounts" class="java.lang.Long"/>
	<group name="site_name">
		<groupExpression><![CDATA[$F{site_name}]]></groupExpression>
		<groupHeader>
			<band height="41">
				<textField>
					<reportElement mode="Opaque" x="10" y="10" width="760" height="20" backcolor="#F7F5F5" uuid="d75e27c4-9344-4fbf-be06-961ac8749455"/>
					<box>
						<topPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
						<leftPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
						<bottomPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
						<rightPen lineWidth="0.5" lineStyle="Solid" lineColor="#000000"/>
					</box>
					<textElement verticalAlignment="Middle">
						<font isBold="true"/>
						<paragraph leftIndent="8"/>
					</textElement>
					<textFieldExpression><![CDATA[$F{site_name}]]></textFieldExpression>
				</textField>
			</band>
		</groupHeader>
	</group>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="61" splitType="Stretch">
			<textField pattern="">
				<reportElement x="10" y="40" width="240" height="20" uuid="f6d70032-34de-4a8d-a721-488a687db879"/>
				<textElement>
					<font size="14"/>
				</textElement>
				<textFieldExpression><![CDATA[DATEFORMAT( $P{report_date}.getEnd(),"MMMM d, yyyy") + " UTC"]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="10" y="10" width="555" height="30" uuid="076463d8-ae4f-4ec3-bd63-08dfd7a2a1ee"/>
				<textElement>
					<font size="18"/>
				</textElement>
				<text><![CDATA[Daily Campaign Activity by Site Report]]></text>
			</staticText>
		</band>
	</title>
	<columnHeader>
		<band height="33" splitType="Stretch">
			<staticText>
				<reportElement x="290" y="0" width="70" height="33" uuid="663d6817-e40d-45ac-9d80-94cc2d7f51af"/>
				<textElement textAlignment="Center" verticalAlignment="Bottom">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[MiniReel Loads]]></text>
			</staticText>
			<staticText>
				<reportElement x="250" y="0" width="40" height="33" uuid="3f945bd5-509a-4e78-9c16-9259e5f62ea7">
					<property name="local_mesure_unitwidth" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.width" value="px"/>
				</reportElement>
				<textElement textAlignment="Center" verticalAlignment="Bottom">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Cards]]></text>
			</staticText>
			<staticText>
				<reportElement x="360" y="0" width="70" height="33" uuid="e3de58eb-0447-4ac7-a84c-d79a46ac5628">
					<property name="local_mesure_unitwidth" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.width" value="px"/>
				</reportElement>
				<textElement textAlignment="Center" verticalAlignment="Bottom">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Card Views]]></text>
			</staticText>
			<staticText>
				<reportElement x="430" y="0" width="70" height="33" uuid="9803f922-9f71-4289-839f-571705dea8c1">
					<property name="local_mesure_unitwidth" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.width" value="px"/>
				</reportElement>
				<textElement textAlignment="Center" verticalAlignment="Bottom">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Plays]]></text>
			</staticText>
			<staticText>
				<reportElement x="500" y="0" width="70" height="33" uuid="759377a1-bc47-4dad-8c10-9f391a9ea74c">
					<property name="local_mesure_unitwidth" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.width" value="px"/>
				</reportElement>
				<textElement textAlignment="Center" verticalAlignment="Bottom">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[AdCounts]]></text>
			</staticText>
			<staticText>
				<reportElement x="570" y="0" width="70" height="33" uuid="0cb895ad-9347-40ef-ace0-7b0b0641f0f3"/>
				<textElement textAlignment="Center" verticalAlignment="Bottom">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Views / Loads]]></text>
			</staticText>
			<staticText>
				<reportElement x="640" y="0" width="70" height="33" uuid="a8732b54-5f4a-413f-849f-385d99456c52">
					<property name="local_mesure_unitwidth" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.width" value="px"/>
				</reportElement>
				<textElement textAlignment="Center" verticalAlignment="Bottom">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[AdCounts / Views]]></text>
			</staticText>
			<staticText>
				<reportElement x="710" y="0" width="60" height="33" uuid="7e4cd35f-db91-4759-a3a7-d62984353159">
					<property name="local_mesure_unitwidth" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.width" value="px"/>
				</reportElement>
				<textElement textAlignment="Center" verticalAlignment="Bottom">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[AdCounts / Loads]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="25" splitType="Stretch">
			<textField>
				<reportElement x="20" y="0" width="220" height="20" uuid="8a2aa8a5-6d5b-4471-ab50-4e13de5942e4"/>
				<textFieldExpression><![CDATA[$F{campaign}]]></textFieldExpression>
			</textField>
			<textField pattern="#,###.###" isBlankWhenNull="true">
				<reportElement x="290" y="0" width="70" height="20" uuid="25b95fdd-2428-48bc-b7d3-f449a743ceb7"/>
				<textElement textAlignment="Right" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{loads}]]></textFieldExpression>
			</textField>
			<textField pattern="#,###.###" isBlankWhenNull="true">
				<reportElement x="250" y="0" width="40" height="20" uuid="2bd64464-727e-4435-a85a-df6b67116120">
					<property name="local_mesure_unitwidth" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.width" value="px"/>
				</reportElement>
				<textElement textAlignment="Right" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{cards}]]></textFieldExpression>
			</textField>
			<textField pattern="#,###.###" isBlankWhenNull="true">
				<reportElement x="360" y="0" width="70" height="20" uuid="4ef69f37-59a2-4a86-b1b0-9883ee3559fa">
					<property name="local_mesure_unitwidth" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.width" value="px"/>
				</reportElement>
				<textElement textAlignment="Right" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{cardviews}]]></textFieldExpression>
			</textField>
			<textField pattern="#,###.###" isBlankWhenNull="true">
				<reportElement x="430" y="0" width="70" height="20" uuid="4c392bc9-8e15-4252-b08d-3b81334d10bf">
					<property name="local_mesure_unitwidth" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.width" value="px"/>
				</reportElement>
				<textElement textAlignment="Right" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{plays}]]></textFieldExpression>
			</textField>
			<textField pattern="#,###.###" isBlankWhenNull="true">
				<reportElement x="500" y="0" width="70" height="20" uuid="7a055223-d3ca-4622-81f1-9335aba73e24">
					<property name="local_mesure_unitwidth" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.width" value="px"/>
				</reportElement>
				<textElement textAlignment="Right" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{adcounts}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0.##%" isBlankWhenNull="true">
				<reportElement x="710" y="0" width="60" height="20" uuid="1e81a153-1628-4867-9029-2fdf3c18ff30"/>
				<textElement textAlignment="Right" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[(double)$F{adcounts}/(double)$F{loads}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0.##%" isBlankWhenNull="true">
				<reportElement x="570" y="0" width="70" height="20" uuid="aeeb53a1-9a90-4e1f-9ccc-c795795bf50f"/>
				<textElement textAlignment="Right" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[(double)$F{cardviews}/(double)$F{loads}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0.##%" isBlankWhenNull="true">
				<reportElement x="640" y="0" width="70" height="20" uuid="abf6010a-cf68-4c39-a9c5-ebcdff9ab224"/>
				<textElement textAlignment="Right" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[(double)$F{adcounts}/(double)$F{cardviews}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
</jasperReport>
